<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆì´ë“œ í¬ë¡œë‹ˆí´ - ë©”ì´í”Œëœë“œ ë¦¬ì €ë ‰ì…˜ íƒ€ì´ë¨¸</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="ìì¿°, í˜¼í…Œì¼ ì›ì • í•„ìˆ˜ ë„êµ¬! ë ˆì´ë“œ í¬ë¡œë‹ˆí´ë¡œ ë¹„ìˆì˜ ë¦¬ì €ë ‰ì…˜ ì¿¨íƒ€ì„ì„ ì™„ë²½í•˜ê²Œ ê´€ë¦¬í•˜ê³ , íŒŒí‹°ì›ë“¤ê³¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒí™©ì„ ê³µìœ í•˜ì„¸ìš”.">
    <meta name="keywords" content="ë©”ì´í”Œëœë“œ, ë©”ëœ, ë¦¬ì €ë ‰ì…˜, íƒ€ì´ë¨¸, ë¦¬ì €, ìì¿°, í˜¼í…Œì¼, ì›ì •ëŒ€, ë ˆì´ë“œ, ë¹„ìˆ, MLFEE, ë©”í”¼">
    <meta property="og:title" content="ë ˆì´ë“œ í¬ë¡œë‹ˆí´ - ë©”ì´í”Œëœë“œ í•„ìˆ˜ ë ˆì´ë“œ íƒ€ì´ë¨¸">
    <meta property="og:description" content="ì‹¤ì‹œê°„ ë™ê¸°í™”ì™€ ì§€ëŠ¥í˜• ì‹œê°„ ì•ˆë‚´ë¡œ ë ˆì´ë“œì˜ ì•ˆì •ì„±ì„ ë†’ì—¬ë³´ì„¸ìš”.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.mlfee.com/timer/">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #0a0e1a;
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 40px 40px;
        }
        
        .main-control-btn {
            @apply w-full max-w-lg text-6xl sm:text-8xl font-black py-10 sm:py-12 px-6 rounded-full shadow-lg border-4 transition-all duration-200 relative overflow-hidden;
        }
        .main-control-btn:not(:disabled):active { @apply transform scale-95 shadow-inner; }
        .main-control-btn:disabled { @apply bg-slate-700 border-slate-600 text-slate-500 cursor-not-allowed opacity-70; }

        .btn-start { @apply bg-gradient-to-br from-cyan-500 to-teal-600 border-cyan-400/50 text-white; }
        .btn-death { @apply bg-gradient-to-br from-red-500 to-red-700 border-red-400/50 text-white; }
        .btn-res { @apply bg-gradient-to-br from-teal-400 to-cyan-500 border-teal-300/50 text-white; }
        
        .gradient-text {
            background: linear-gradient(to right, #2DD4BF, #22D3EE);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-cooldown { color: #f97316; }

        .modal-backdrop { @apply fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-[1002]; animation: fadeIn 0.3s ease-out; }
        .modal-content { @apply bg-slate-800/80 backdrop-blur-lg rounded-2xl shadow-2xl p-8 w-full text-center border border-slate-700; animation: slideIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        .summary-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out, margin 0.5s ease-in-out;
            padding-top: 0;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        .summary-container.expanded {
            max-height: 1000px;
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 2px solid #334155;
            border-bottom: 2px solid #334155;
        }
        
        .hamburger-icon span {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .nav-toggle.active .hamburger-icon span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .nav-toggle.active .hamburger-icon span:nth-child(2) { opacity: 0; }
        .nav-toggle.active .hamburger-icon span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 flex items-center justify-center min-h-screen p-4">

    <!-- Sidebar Navigation -->
    <div id="sidebar-toggle" class="nav-toggle fixed top-5 right-5 z-[1001] cursor-pointer w-12 h-12 bg-gray-800/80 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg border border-gray-700">
        <div class="hamburger-icon space-y-1.5">
            <span class="block w-6 h-0.5 bg-white"></span>
            <span class="block w-6 h-0.5 bg-white"></span>
            <span class="block w-6 h-0.5 bg-white"></span>
        </div>
    </div>
    <nav id="sidebar" class="side-nav fixed right-0 top-0 w-72 h-full bg-gray-800/90 backdrop-blur-lg border-l-2 border-gray-700 z-[1000] shadow-2xl transition-transform duration-300 ease-in-out translate-x-full">
        <h3 class="text-center text-2xl font-bold gradient-text mt-16 mb-8">ë©”ë‰´</h3>
        <a href="https://mlfee.com" class="block py-3 px-8 text-lg text-gray-300 hover:bg-gray-700 hover:text-sky-400 transition">í™ˆ</a>
        <a href="https://mlfee.vercel.app/updates" target="_blank" class="block py-3 px-8 text-lg text-gray-300 hover:bg-gray-700 hover:text-sky-400 transition">ì—…ë°ì´íŠ¸</a>
        <a href="https://www.mlfee.com/calc/" class="block py-3 px-8 text-lg text-gray-300 hover:bg-gray-700 hover:text-sky-400 transition">ìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸°</a>
        <a href="https://www.mlfee.com/timer/" class="block py-3 px-8 text-lg text-gray-300 hover:bg-gray-700 hover:text-sky-400 transition">ë¦¬ì € íƒ€ì´ë¨¸</a>
        <a href="#how-to-guide" id="guideLink" class="block py-3 px-8 text-lg text-gray-300 hover:bg-gray-700 hover:text-sky-400 transition">ì„¤ëª…ì„œ</a>
        <a href="#" id="contactLink" class="block py-3 px-8 text-lg text-gray-300 hover:bg-gray-700 hover:text-sky-400 transition">ë¬¸ì˜</a>
    </nav>
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[999] hidden"></div>

    <!-- App Container -->
    <div id="app" class="w-full max-w-4xl mx-auto">
        <div id="raid-view">
            <div class="bg-gray-800/50 rounded-2xl shadow-2xl p-6 relative backdrop-blur-sm border border-slate-700">
                <div class="absolute top-4 right-16 flex gap-2">
                    <button id="muteBtn" class="bg-slate-700 hover:bg-slate-600 text-slate-300 text-sm font-bold py-1.5 px-4 rounded-full transition-colors">ì†Œë¦¬ ë„ê¸°</button>
                    <button id="endRaidBtn" class="bg-red-600 hover:bg-red-500 text-white text-sm font-bold py-1.5 px-4 rounded-full transition-colors hidden">ë ˆì´ë“œ ì¢…ë£Œ</button>
                    <button id="resetBtn" class="bg-red-800 hover:bg-red-700 text-white text-sm font-bold py-1.5 px-4 rounded-full transition-colors">ì´ˆê¸°í™”</button>
                </div>
                
                <div class="text-center mb-6">
                    <h1 class="text-5xl font-black gradient-text tracking-wider">ë ˆì´ë“œ í¬ë¡œë‹ˆí´</h1>
                    <div id="totalTime" class="mt-2">
                        <span class="text-lg font-semibold text-slate-400">ë ˆì´ë“œ ê²½ê³¼</span>
                        <p class="text-4xl font-bold tracking-wider font-mono text-slate-200">00:00</p>
                    </div>
                </div>
                
                <div id="summaryContainer" class="summary-container">
                    <div id="summaryContent" class="text-left space-y-4 text-slate-300 text-lg"></div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 border-t border-b border-slate-700 py-6">
                    <div class="text-center">
                        <p class="text-base text-slate-400 mb-1">í˜„ì¬ ì‹œê° (KST)</p>
                        <p id="kstTime" class="text-5xl font-bold tracking-wider font-mono text-teal-300">00:00:00</p>
                    </div>
                    <div class="space-y-4">
                        <div id="resTimesDisplay" class="text-center cursor-pointer hidden p-2 rounded-lg hover:bg-slate-700/50 transition-colors" title="í´ë¦­í•˜ì—¬ ë¶„ ë‹¨ìœ„ ì‹œê°„ ë³µì‚¬">
                            <p class="text-base text-yellow-400 mb-1">ë¦¬ì € ê¶Œì¥ ë° ì˜ˆìƒ ì‹œê°</p>
                            <p id="resTimesList" class="text-3xl md:text-4xl font-bold tracking-wider font-mono text-yellow-300">-</p>
                        </div>
                    </div>
                </div>

                <div id="control-panel" class="flex flex-col items-center justify-center min-h-[200px]"></div>
                
                <div id="resGaugeContainer" class="hidden pt-4 mt-4">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-lg text-emerald-400 font-bold">ë¦¬ì €ë ‰ì…˜ ìœ íš¨ ì‹œê°„</span>
                        <span id="resurrectionTime" class="text-2xl font-bold tracking-wider text-emerald-400 font-mono">--:--</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-4 overflow-hidden">
                        <div id="resGaugeBar" class="h-4 rounded-full transition-all duration-500 bg-gradient-to-r from-emerald-500 to-teal-600"></div>
                    </div>
                </div>
                
                <div id="briefing" class="mt-6 text-center text-slate-300 font-semibold h-6 text-lg"></div>

                <div id="bishopSection" class="mt-8">
                     <div class="flex justify-between items-center mb-2 px-2">
                         <h2 class="text-xl font-bold text-slate-300">íŒŒí‹°ì› ê´€ë¦¬</h2>
                         <button id="addBishopBtn" class="bg-teal-600 hover:bg-teal-500 text-white font-bold py-1 px-4 rounded-full transition-colors text-lg">+</button>
                     </div>
                     <div class="overflow-x-auto bg-slate-900/70 rounded-lg p-2">
                         <table class="w-full text-left text-xl"><thead class="border-b border-slate-700"><tr class="text-base text-slate-400"><th class="p-3">ìˆœë²ˆ</th><th class="p-3">ë¹„ìˆ</th><th class="p-3">ìƒíƒœ</th><th class="p-3">ì¿¨íƒ€ì„</th><th class="p-3">ì‚¬ìš© ì‹œê°</th><th class="p-3"></th></tr></thead><tbody id="bishop-list"></tbody></table>
                     </div>
                </div>
                
                <div id="log-section" class="mt-8 bg-slate-900/70 rounded-lg">
                    <h2 class="p-4 font-bold text-lg text-slate-300 text-center border-b border-slate-700">ì´ë²¤íŠ¸ ë¡œê·¸</h2>
                    <div id="eventLog" class="p-3 space-y-2 overflow-y-auto h-48 text-base"></div>
                </div>
                
                <div id="how-to-guide" class="mt-12">
                    <div class="border-t-2 border-slate-700 pt-8">
                        <h2 class="text-4xl font-black text-center gradient-text mb-8">ë ˆì´ë“œ í¬ë¡œë‹ˆí´ í™œìš© ê°€ì´ë“œ</h2>
                        <div class="space-y-12 text-slate-300 leading-relaxed text-lg bg-slate-900/50 p-8 rounded-xl">
                            <section>
                                <h3 class="text-2xl font-bold text-white mb-4 border-l-4 border-teal-400 pl-4">1. ë ˆì´ë“œ í¬ë¡œë‹ˆí´ì´ë€?</h3>
                                <p>ë ˆì´ë“œ í¬ë¡œë‹ˆí´ì€ ë©”ì´í”Œëœë“œì˜ ìì¿°, í˜¼í…Œì¼ê³¼ ê°™ì€ ë³´ìŠ¤ ì›ì •ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œ ì¤‘ í•˜ë‚˜ì¸ 'ë¦¬ì €ë ‰ì…˜'ì˜ ë³µì¡í•œ ì¿¨íƒ€ì„ì„ ê´€ë¦¬í•´ì£¼ëŠ” ìŠ¤ë§ˆíŠ¸ íƒ€ì´ë¨¸ì…ë‹ˆë‹¤. íŒŒí‹°ì˜ ì „ë©¸ì„ ë§‰ê³  ì•ˆì •ì ì¸ í´ë¦¬ì–´ë¥¼ ë•ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë” ì´ìƒ ìˆ˜ë™ìœ¼ë¡œ ì‹œê°„ì„ ê³„ì‚°í•˜ê±°ë‚˜ ê¸°ì–µí•  í•„ìš” ì—†ì´, ì´ ë„êµ¬ê°€ ëª¨ë“  ê²ƒì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìŒì„±ìœ¼ë¡œ ì•Œë ¤ì¤ë‹ˆë‹¤.</p>
                            </section>
                            <section>
                                <h3 class="text-2xl font-bold text-white mb-4 border-l-4 border-teal-400 pl-4">2. í•µì‹¬ ì›ë¦¬: 14ë¶„ì˜ ë§ˆë²•</h3>
                                <p>ë¦¬ì €ë ‰ì…˜ì˜ ì¿¨íƒ€ì„ì€ 30ë¶„ì´ì§€ë§Œ, ë²„í”„ ì§€ì†ì‹œê°„ì€ 15ë¶„ì…ë‹ˆë‹¤. ì•ˆì •ì ì¸ ë ˆì´ë“œë¥¼ ìœ„í•´ì„œëŠ” 15ë¶„ ì•ˆì— ë‹¤ìŒ ë¦¬ì €ë ‰ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì´ìƒì ì…ë‹ˆë‹¤. ë ˆì´ë“œ í¬ë¡œë‹ˆí´ì€ 1ë¶„ì˜ ì—¬ìœ  ì‹œê°„ì„ ë‘ì–´, **14ë¶„ ì£¼ê¸°**ë¡œ ë¦¬ì €ë ‰ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ë©° ëª¨ë“  ì‹œê°„ì„ ìë™ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤. ì´ '14ë¶„ì˜ ë§ˆë²•'ë§Œ ê¸°ì–µí•˜ë©´ ë‹¹ì‹ ë„ ìµœê³ ì˜ ì˜¤ë”ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </section>
                            <section>
                                <h3 class="text-2xl font-bold text-white mb-4 border-l-4 border-teal-400 pl-4">3. ìƒì„¸ ê¸°ëŠ¥ ì•Œì•„ë³´ê¸°</h3>
                                <ul class="space-y-6 list-disc list-inside">
                                    <li><strong class="text-sky-400 text-xl block mb-2">ì§€ëŠ¥í˜• ì‹œê°„ ì•ˆë‚´ & ì›í´ë¦­ ë³µì‚¬</strong>
                                        <p>ì‚¬ë§ì ë°œìƒ ì‹œ, 14ë¶„ ë’¤ì˜ ê¶Œì¥ ì‹œê°„ê³¼ ê·¸ë¡œë¶€í„° +14ë¶„, +28ë¶„ ë’¤ì˜ ì˜ˆìƒ ì‹œê°„ì„ í•¨ê»˜ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ ì‹œê°„ ì˜ì—­ì„ í´ë¦­í•˜ë©´ **"21, 35, 49 ë¦¬ì €"** ì™€ ê°™ì´ íŒŒí‹° ì±„íŒ…ì— ë°”ë¡œ ê³µìœ í•  ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì–´ ì‹ ì†í•œ ì˜¤ë”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                                    </li>
                                    <li><strong class="text-sky-400 text-xl block mb-2">ì™„ì „ ìë™í™”ëœ íë¦„ & ìŒì„± ì•ˆë‚´</strong>
                                        <p>'ë ˆì´ë“œ ì‹œì‘' í›„ 5ì´ˆ, 'ë¦¬ì €ë ‰ì…˜ ì‚¬ìš©' í›„ 3ì´ˆ ë’¤ì— ë‹¤ìŒ íƒ€ì´ë¨¸ê°€ ìë™ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤. "5ì´ˆ í›„ ìë™ ì‹œì‘", "ì‚¬ë§, ë¦¬ì € íƒ€ì´ë¨¸ ì‹œì‘" ë“± ì¤‘ìš”í•œ ìˆœê°„ì„ ìŒì„±ìœ¼ë¡œ ì•ˆë‚´í•˜ì—¬ ë ˆì´ë“œì— ë”ìš± ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                    </li>
                                    <li><strong class="text-sky-400 text-xl block mb-2">ììœ ë¡œìš´ íŒŒí‹°ì› ê´€ë¦¬</strong>
                                        <p>ë ˆì´ë“œ ì‹œì‘ ì „, '+' ë²„íŠ¼ìœ¼ë¡œ ë¹„ìˆì„ ì¶”ê°€í•˜ê³  'X' ë²„íŠ¼ìœ¼ë¡œ ì œì™¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 2ì¸ ë¹„ìˆ, 4ì¸ ë¹„ìˆ ë“± ì–´ë–¤ íŒŒí‹° êµ¬ì„±ì—ë„ ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹„ìˆì˜ ì´ë¦„ì„ í´ë¦­í•˜ì—¬ íŒŒí‹°ì›ì˜ ë‹‰ë„¤ì„ìœ¼ë¡œ ì§ì ‘ ë³€ê²½í•´ë³´ì„¸ìš”.</p>
                                    </li>
                                    <li><strong class="text-sky-400 text-xl block mb-2">ìƒì„¸ ê²°ê³¼ ë³´ê³ ì„œ</strong>
                                        <p>'ë ˆì´ë“œ ì¢…ë£Œ' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì´ ë ˆì´ë“œ ì‹œê°„, íŒŒí‹°ì›ë³„ ë¦¬ì €ë ‰ì…˜ ì‚¬ìš© íšŸìˆ˜, ì´ ì‚¬ë§ íšŸìˆ˜, ê·¸ë¦¬ê³  ëª¨ë“  ì´ë²¤íŠ¸ê°€ ê¸°ë¡ëœ ìƒì„¸ ë¡œê·¸ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆëŠ” ê²°ê³¼ì°½ì´ ë‚˜íƒ€ë‚˜, ë ˆì´ë“œì— ëŒ€í•œ ìƒì„¸í•œ í”¼ë“œë°±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                                    </li>
                                </ul>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="contactModal" class="modal-backdrop items-center justify-center hidden">
        <div class="modal-content max-w-sm">
            <button id="closeContactModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition text-2xl">&times;</button>
            <h3 class="text-2xl font-bold text-yellow-400">ë¬¸ì˜í•˜ê¸°</h3>
            <div class="space-y-4 mt-6">
                <a href="mailto:esgroup129@gmail.com" class="w-full flex items-center justify-center bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" /><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" /></svg>
                    ì´ë©”ì¼
                </a>
                <a href="https://open.kakao.com/o/s4YH6WFh" target="_blank" class="w-full flex items-center justify-center bg-[#FEE500] hover:bg-yellow-400 text-black font-bold py-3 px-4 rounded-lg transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12.01,2C6.48,2,2,6.04,2,11.05c0,3.33,1.97,6.25,4.8,7.74L6,22l3.42-2.35C10.43,19.88,11.21,20,12.01,20c5.52,0,10-4.04,10-8.95S17.53,2,12.01,2z"/></svg>
                    ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…
                </a>
                <a href="https://discord.com/users/930037107823636540" target="_blank" class="w-full flex items-center justify-center bg-[#5865F2] hover:bg-indigo-500 text-white font-bold py-3 px-4 rounded-lg transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.037c-1.02 3.626-1.222 7.79- .284 11.654a.052.052 0 0 0 .016.053c.087.063.18.129.27.195a.05.05 0 0 0 .051.007c2.175-1.566 3.971-4.42 3.971-4.42s.709.64 2.274.64c1.566 0 2.274-.64 2.274-.64s1.796 2.854 3.97 4.42a.05.05 0 0 0 .051-.007c.09-.066.183-.132.27-.195a.052.052 0 0 0 .016-.053c.938-3.864.736-8.028-.284-11.654a.041.041 0 0 0-.021-.037zM8.02 10.842c-.837 0-1.518-.682-1.518-1.518s.681-1.518 1.518-1.518c.837 0 1.518.682 1.518 1.518s-.681 1.518-1.518 1.518zm3.515 0c-.837 0-1.518-.682-1.518-1.518s.681-1.518 1.518-1.518c.837 0 1.518.682 1.518 1.518s-.681 1.518-1.518 1.518z"/>
                    </svg>
                    ë””ìŠ¤ì½”ë“œ
                </a>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal-backdrop items-center justify-center hidden">
        <div class="modal-content max-w-sm">
            <h3 id="confirmModalTitle" class="text-2xl font-bold text-yellow-400">í™•ì¸</h3>
            <p id="confirmModalMessage" class="mt-4 text-lg text-slate-300"></p>
            <div class="mt-6 flex justify-end gap-4">
                <button id="confirmCancelBtn" class="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-6 rounded-lg transition">ì·¨ì†Œ</button>
                <button id="confirmOkBtn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-lg transition">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const RES_DURATION = 15 * 60;
            const BISHOP_COOLDOWN = 30 * 60;
            const IDEAL_CYCLE_TIME = 14 * 60; 

            const dom = {
                totalTime: document.getElementById('totalTime').querySelector('p'),
                resTime: document.getElementById('resurrectionTime'),
                controlPanel: document.getElementById('control-panel'),
                bishopSection: document.getElementById('bishopSection'),
                addBishopBtn: document.getElementById('addBishopBtn'),
                bishopList: document.getElementById('bishop-list'),
                resetBtn: document.getElementById('resetBtn'),
                muteBtn: document.getElementById('muteBtn'),
                endRaidBtn: document.getElementById('endRaidBtn'),
                briefing: document.getElementById('briefing'),
                kstTime: document.getElementById('kstTime'),
                resGaugeContainer: document.getElementById('resGaugeContainer'),
                resGaugeBar: document.getElementById('resGaugeBar'),
                eventLog: document.getElementById('eventLog'),
                logSection: document.getElementById('log-section'),
                resTimesDisplay: document.getElementById('resTimesDisplay'),
                resTimesList: document.getElementById('resTimesList'),
                summaryContainer: document.getElementById('summaryContainer'),
                summaryContent: document.getElementById('summaryContent'),
                sidebarToggle: document.getElementById('sidebar-toggle'),
                sidebar: document.getElementById('sidebar'),
                sidebarOverlay: document.getElementById('sidebar-overlay'),
                guideLink: document.getElementById('guideLink'),
                contactLink: document.getElementById('contactLink'),
                contactModal: document.getElementById('contactModal'),
                closeContactModalBtn: document.getElementById('closeContactModalBtn'),
                // Confirmation Modal elements
                confirmModal: document.getElementById('confirmModal'),
                confirmModalTitle: document.getElementById('confirmModalTitle'),
                confirmModalMessage: document.getElementById('confirmModalMessage'),
                confirmOkBtn: document.getElementById('confirmOkBtn'),
                confirmCancelBtn: document.getElementById('confirmCancelBtn'),
            };

            let timerInterval = null, isMuted = false, autoDeathTimeoutId = null;
            let raidState = {};
            let confirmCallback = null;

            function getInitialState() {
                return {
                    state: 'initial',
                    raidStartedAt: null,
                    totalSeconds: 0,
                    resurrectionActiveUntil: null,
                    resScheduleTimes: [],
                    currentBishopIndex: 0,
                    bishops: [
                        { name: 'ë¹„ìˆA', cooldownEndsAt: null, usedAt: null, resCount: 0 },
                        { name: 'ë¹„ìˆB', cooldownEndsAt: null, usedAt: null, resCount: 0 },
                        { name: 'ë¹„ìˆC', cooldownEndsAt: null, usedAt: null, resCount: 0 },
                    ],
                    logs: [{ timestamp: new Date().toISOString(), message: 'ë ˆì´ë“œ í¬ë¡œë‹ˆí´ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', type: 'system' }]
                };
            }

            function init() {
                raidState = getInitialState();
                render(raidState);
                setInterval(updateKstClock, 1000);
                attachEventListeners();
            }
            
            function render(data) {
                if (!data) return;

                if (timerInterval) clearInterval(timerInterval);
                if (data.state !== 'ended') {
                    timerInterval = setInterval(() => updateTimers(data), 1000);
                }
                updateTimers(data);

                dom.endRaidBtn.classList.toggle('hidden', data.state === 'initial' || data.state === 'ended');
                dom.resGaugeContainer.classList.toggle('hidden', data.state !== 'res-active');
                dom.addBishopBtn.disabled = data.state !== 'initial';
                dom.logSection.classList.toggle('hidden', data.state === 'ended');
                dom.bishopSection.classList.toggle('hidden', data.state === 'ended');
                
                if (data.state !== 'ended') {
                    dom.summaryContainer.classList.remove('expanded');
                }

                renderControlPanel(data);
                renderBishopList(data.bishops, data.currentBishopIndex, data.state);
                renderLogs(data.logs);
            }
            
            function updateTimers(data) {
                updateKstClock();
                if (data.state === 'initial' || data.state === 'ended') {
                    dom.totalTime.textContent = formatTime(data.totalSeconds, false);
                    dom.resTimesDisplay.classList.add('hidden');
                    updateBishopCooldowns(data.bishops, data.currentBishopIndex, data.state);
                    return;
                }

                const now = Date.now();
                
                if (data.raidStartedAt) {
                    const elapsed = now - data.raidStartedAt;
                    dom.totalTime.textContent = formatTime(Math.floor(elapsed / 1000), false);
                }

                if (data.state === 'res-active' && data.resurrectionActiveUntil) {
                    const resSeconds = Math.max(0, Math.floor((data.resurrectionActiveUntil - now) / 1000));
                    dom.resTime.textContent = formatTime(resSeconds, false);
                    dom.resGaugeBar.style.width = `${(resSeconds / RES_DURATION) * 100}%`;
                    
                    const gaugeClasses = dom.resGaugeBar.classList;
                    gaugeClasses.remove('from-emerald-500', 'from-yellow-500', 'from-red-500', 'to-teal-600', 'to-orange-500', 'to-red-600');
                    if (resSeconds <= 60) gaugeClasses.add('bg-gradient-to-r', 'from-red-500', 'to-red-600');
                    else if (resSeconds <= 300) gaugeClasses.add('bg-gradient-to-r', 'from-yellow-500', 'to-orange-500');
                    else gaugeClasses.add('bg-gradient-to-r', 'from-emerald-500', 'to-teal-600');
                    
                    if (data.resScheduleTimes && data.resScheduleTimes.length > 0) {
                        const timeStrings = data.resScheduleTimes.map(ts => formatClockTime(new Date(ts)));
                        
                        const firstTime = `<span class="text-yellow-300">${timeStrings[0]}</span>`;
                        const nextTimes = timeStrings.slice(1).join('<span class="text-slate-500"> / </span>');
                        
                        dom.resTimesList.innerHTML = `${firstTime} <span class="text-slate-500">/</span> ${nextTimes}`;
                        dom.resTimesDisplay.classList.remove('hidden');
                    }
                } else {
                    dom.resGaugeContainer.classList.add('hidden');
                    dom.resTimesDisplay.classList.add('hidden');
                }

                // [FIX] Call functions that update high-frequency data
                updateBishopCooldowns(data.bishops, data.currentBishopIndex, data.state);
                renderControlPanel(data);
            }

            function renderControlPanel(data) {
                let buttonHTML = '', briefingText = '';

                switch (data.state) {
                    case 'initial':
                        buttonHTML = `<button id="startRaidBtn" class="main-control-btn btn-start">ë ˆì´ë“œ ì‹œì‘</button>`;
                        briefingText = "íŒŒí‹°ì›ì„ ì„¤ì •í•˜ê³  ë ˆì´ë“œë¥¼ ì‹œì‘í•˜ì„¸ìš”.";
                        break;
                    case 'running':
                        buttonHTML = `<button id="deathBtn" class="main-control-btn btn-death">ì‚¬ë§ì ë°œìƒ</button>`;
                        briefingText = data.bishops.length > 0 ? `ğŸŸ¢ ë‹¤ìŒ ë¦¬ì €: ${data.bishops[data.currentBishopIndex].name}` : 'ë¹„ìˆì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.';
                        break;
                    case 'res-active':
                        const bishop = data.bishops[data.currentBishopIndex];
                        const now = Date.now();
                        const onCooldown = bishop.cooldownEndsAt && bishop.cooldownEndsAt > now;
                        const cooldownSeconds = onCooldown ? Math.floor((bishop.cooldownEndsAt - now) / 1000) : 0;
                        
                        buttonHTML = `<button id="useResBtn" class="main-control-btn btn-res" ${onCooldown ? 'disabled' : ''}>${bishop.name} ë¦¬ì € ì‚¬ìš©</button>`;
                        briefingText = onCooldown ? `ğŸ”´ ${bishop.name} ì¿¨íƒ€ì„! (${formatTime(cooldownSeconds, false)} ë‚¨ìŒ)` : `ğŸš¨ ${bishop.name}ë‹˜, ë¦¬ì €ë ‰ì…˜ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”!`;
                        break;
                    case 'ended':
                        buttonHTML = `<p class="text-3xl font-bold text-amber-400">ë ˆì´ë“œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>`;
                        briefingText = "ê²°ê³¼ ìš”ì•½ì„ í™•ì¸í•˜ê±°ë‚˜ ì´ˆê¸°í™” í›„ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.";
                        break;
                }
                dom.controlPanel.innerHTML = buttonHTML;
                dom.briefing.textContent = briefingText;
            }
            
            // This function builds the list structure. Called on major state changes.
            function renderBishopList(bishops, currentIndex, state) {
                dom.bishopList.innerHTML = '';
                if (!bishops) return;
                bishops.forEach((b, i) => {
                    const row = document.createElement('tr');
                    row.className = `border-b border-slate-700/50`;
                    row.innerHTML = `
                        <td class="p-3">${i + 1}</td>
                        <td class="p-3 bishop-name cursor-pointer hover:bg-slate-700 rounded-md" contenteditable="${state === 'initial'}" data-index="${i}">${b.name}</td>
                        <td class="p-3 font-bold"></td>
                        <td class="p-3 font-mono"></td>
                        <td class="p-3 font-mono">${b.usedAt ? formatClockTime(new Date(b.usedAt)) : '--:--:--'}</td>
                        <td class="p-3 text-center"><button class="remove-bishop-btn text-red-500 hover:text-red-400 font-bold text-2xl ${state !== 'initial' ? 'hidden' : ''}" data-index="${i}">&times;</button></td>
                    `;
                    dom.bishopList.appendChild(row);
                });
                // After building, do an initial update of cooldowns and statuses
                updateBishopCooldowns(bishops, currentIndex, state);
            }

            // [NEW] This function only updates text content, preserving the DOM structure.
            // This prevents the contenteditable field from being reset.
            function updateBishopCooldowns(bishops, currentIndex, state) {
                if (!bishops) return;
                const rows = dom.bishopList.querySelectorAll('tr');
                if (rows.length !== bishops.length) return; // Exit if list is out of sync

                bishops.forEach((b, i) => {
                    const row = rows[i];
                    if (!row) return;

                    const now = Date.now();
                    const onCooldown = b.cooldownEndsAt && b.cooldownEndsAt > now;
                    const cooldownSeconds = onCooldown ? Math.floor((b.cooldownEndsAt - now) / 1000) : 0;
                    const statusText = onCooldown ? 'ì¿¨íƒ€ì„' : 'ëŒ€ê¸°';
                    const statusClass = onCooldown ? 'status-cooldown' : 'text-green-400';
                    const isCurrent = i === currentIndex && (state === 'running' || state === 'res-active');

                    const statusCell = row.cells[2];
                    const cooldownCell = row.cells[3];

                    if (statusCell) {
                        statusCell.textContent = statusText;
                        statusCell.className = `p-3 font-bold ${statusClass}`;
                    }
                    if (cooldownCell) {
                        cooldownCell.textContent = onCooldown ? formatTime(cooldownSeconds, false) : 'ì‚¬ìš© ê°€ëŠ¥';
                    }
                    
                    row.classList.toggle('bg-sky-900/50', isCurrent);
                });
            }
            
            function renderLogs(logs) {
                dom.eventLog.innerHTML = '';
                if (!logs || logs.length === 0) return;
                
                logs.slice(-20).forEach(log => {
                     const colors = { info: 'text-slate-400', success: 'text-cyan-400', warning: 'text-orange-400', system: 'text-amber-400' };
                     const logEntry = document.createElement('div');
                     const timestamp = new Date(log.timestamp).toLocaleTimeString('ko-KR', { hour12: false });
                     logEntry.innerHTML = `<span class="font-mono text-slate-500">[${timestamp}]</span> <span class="${colors[log.type] || 'text-slate-400'}">${log.message}</span>`;
                     dom.eventLog.appendChild(logEntry);
                });
                 dom.eventLog.scrollTop = dom.eventLog.scrollHeight;
            }

            function addLog(message, type = 'info') {
                raidState.logs.push({ timestamp: new Date().toISOString(), message, type });
                renderLogs(raidState.logs);
            }

            function handleStartRaid() {
                raidState.state = 'running';
                raidState.raidStartedAt = Date.now();
                addLog('ë ˆì´ë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'system');
                speak('ë ˆì´ë“œ ì‹œì‘');
                addLog('5ì´ˆ í›„, ì‚¬ë§ì íƒ€ì´ë¨¸ê°€ ìë™ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤.', 'info');
                speak('5ì´ˆ í›„, ìë™ ì‹œì‘');
                autoDeathTimeoutId = setTimeout(handleDeath, 5000);
                render(raidState);
            }

            function handleDeath() {
                if (autoDeathTimeoutId) clearTimeout(autoDeathTimeoutId);
                raidState.state = 'res-active';
                const now = Date.now();
                raidState.resurrectionActiveUntil = now + RES_DURATION * 1000;
                
                const recommendedTime = new Date(now + IDEAL_CYCLE_TIME * 1000);
                raidState.resScheduleTimes = [
                    recommendedTime.getTime(),
                    recommendedTime.getTime() + IDEAL_CYCLE_TIME * 1000,
                    recommendedTime.getTime() + IDEAL_CYCLE_TIME * 2 * 1000
                ];

                addLog('ì‚¬ë§ì ë°œìƒ. ë¦¬ì € íƒ€ì´ë¨¸ ì‹œì‘.', 'warning');
                speak('ì‚¬ë§, ë¦¬ì € íƒ€ì´ë¨¸ ì‹œì‘');
                render(raidState);
            }

            function handleUseResurrection() {
                if (raidState.bishops.length === 0) return;
                const now = Date.now();
                const bishop = raidState.bishops[raidState.currentBishopIndex];
                if (bishop.cooldownEndsAt && bishop.cooldownEndsAt > now) return;

                const deadlineMinutes = new Date(raidState.resurrectionActiveUntil).getMinutes();
                addLog(`${bishop.name}ë‹˜ì´ ë¦¬ì €ë ‰ì…˜ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.`, 'success');
                speak(`${bishop.name}, ${deadlineMinutes}ë¶„ ë¦¬ì € ì‚¬ìš©`);

                raidState.state = 'running';
                raidState.resurrectionActiveUntil = null;
                raidState.resScheduleTimes = [];
                bishop.resCount++;
                bishop.cooldownEndsAt = now + BISHOP_COOLDOWN * 1000;
                bishop.usedAt = now;
                raidState.currentBishopIndex = (raidState.currentBishopIndex + 1) % raidState.bishops.length;
                
                addLog('3ì´ˆ í›„, ë‹¤ìŒ ì‚¬ë§ì íƒ€ì´ë¨¸ê°€ ìë™ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤.', 'info');
                speak('3ì´ˆ í›„, ìë™ ì‹œì‘');
                autoDeathTimeoutId = setTimeout(handleDeath, 3000);
                render(raidState);
            }
            
            function handleReset() {
                showConfirmation("ì •ë§ë¡œ ëª¨ë“  ì§„í–‰ ìƒí™©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", () => {
                    if (autoDeathTimeoutId) clearTimeout(autoDeathTimeoutId);
                    if (timerInterval) clearInterval(timerInterval);
                    raidState = getInitialState();
                    addLog('ë ˆì´ë“œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'system');
                    render(raidState);
                });
            }

            function handleEndRaid() {
                if (timerInterval) clearInterval(timerInterval);
                if (autoDeathTimeoutId) clearTimeout(autoDeathTimeoutId);
                raidState.state = 'ended';
                addLog('ë ˆì´ë“œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ ìš”ì•½ì„ í‘œì‹œí•©ë‹ˆë‹¤.', 'system');

                const finalSeconds = raidState.raidStartedAt ? Math.floor((Date.now() - raidState.raidStartedAt) / 1000) : 0;
                raidState.totalSeconds = finalSeconds;

                const totalDuration = formatTime(finalSeconds);
                const startTime = raidState.raidStartedAt ? formatClockTime(new Date(raidState.raidStartedAt)) : 'N/A';
                const endTime = formatClockTime(new Date());

                let bishopSummaryHtml = raidState.bishops.map(bishop => {
                    return `<p class="py-1"><strong>${bishop.name}:</strong> ë¦¬ì €ë ‰ì…˜ ${bishop.resCount}íšŒ ì‚¬ìš©</p>`;
                }).join('');

                const totalDeaths = raidState.logs.filter(log => log.type === 'warning').length;

                const summaryHtml = `
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-3xl font-bold text-amber-400">ë ˆì´ë“œ ê²°ê³¼ ìš”ì•½</h4>
                        <button id="copySummaryBtn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-full transition-colors">ê°„í¸ ìš”ì•½ ë³µì‚¬</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-slate-900/50 p-4 rounded-lg">
                            <h5 class="text-xl font-bold text-teal-300 mb-2">ì¢…í•© ì •ë³´</h5>
                            <p><strong>ì´ ë ˆì´ë“œ ì‹œê°„:</strong> ${totalDuration}</p>
                            <p><strong>ì‹œì‘ ì‹œê°:</strong> ${startTime}</p>
                            <p><strong>ì¢…ë£Œ ì‹œê°:</strong> ${endTime}</p>
                            <p><strong>ì´ ì‚¬ë§ íšŸìˆ˜:</strong> ${totalDeaths}íšŒ</p>
                        </div>
                        <div class="bg-slate-900/50 p-4 rounded-lg">
                            <h5 class="text-xl font-bold text-teal-300 mb-2">íŒŒí‹°ì›ë³„ ë¦¬ì €ë ‰ì…˜ ì‚¬ìš© íšŸìˆ˜</h5>
                            ${bishopSummaryHtml || '<p>ë¦¬ì €ë ‰ì…˜ ì‚¬ìš© ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                        </div>
                    </div>
                `;

                dom.summaryContent.innerHTML = summaryHtml;
                dom.summaryContainer.classList.add('expanded');
                
                const copyBtn = document.getElementById('copySummaryBtn');
                if(copyBtn) {
                    copyBtn.addEventListener('click', () => {
                        const bishopResText = raidState.bishops.map(b => `${b.name}: ${b.resCount}íšŒ`).join(' / ');
                        const textToCopy = `ì´ ì‹œê°„: ${formatTime(finalSeconds, false)}, ì´ ë°ì¹´: ${totalDeaths}íšŒ / ${bishopResText}`;
                        copyToClipboard(textToCopy, "ê°„í¸ ìš”ì•½ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    });
                }

                render(raidState);
            }
            
            function updateBishopName(index, newName) {
                if (!newName || !raidState.bishops[index]) {
                    // If name is empty, revert to the old name
                    render(raidState);
                    return;
                };
                const oldName = raidState.bishops[index].name;
                raidState.bishops[index].name = newName;
                addLog(`ë¹„ìˆ '${oldName}'ì˜ ì´ë¦„ì´ '${newName}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
                // No need to call render here as the blur event handles it.
                // Just update the state. The control panel might need an update though.
                renderControlPanel(raidState);
            }
            
            function addBishop() {
                if (raidState.state !== 'initial') return;
                const newBishopName = `ë¹„ìˆ${String.fromCharCode(65 + raidState.bishops.length)}`;
                raidState.bishops.push({ name: newBishopName, cooldownEndsAt: null, usedAt: null, resCount: 0 });
                addLog(`${newBishopName}ì´(ê°€) íŒŒí‹°ì— ì°¸ê°€í–ˆìŠµë‹ˆë‹¤.`, 'info');
                render(raidState);
            }

            function removeBishop(index) {
                if (raidState.state !== 'initial' || !raidState.bishops[index]) return;
                const removedBishop = raidState.bishops.splice(index, 1)[0];
                addLog(`${removedBishop.name}ì´(ê°€) íŒŒí‹°ì—ì„œ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
                
                if (raidState.currentBishopIndex >= raidState.bishops.length) {
                    raidState.currentBishopIndex = 0;
                }
                render(raidState);
            }

            function formatTime(s, showSeconds = true) {
                if (s <= 0 || isNaN(s)) return showSeconds ? '00:00:00' : '00:00';
                const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = Math.floor(s % 60);
                return showSeconds ? `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}` : `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            }
            function formatClockTime(date) { return date.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }); }
            function updateKstClock() { dom.kstTime.textContent = formatClockTime(new Date()); }
            function speak(text) {
                if (isMuted || !('speechSynthesis' in window)) return;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR';
                utterance.rate = 1.4;
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(utterance);
            }
            
            function showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'fixed bottom-5 left-1/2 -translate-x-1/2 bg-sky-500 text-white py-2 px-4 rounded-lg shadow-lg transition-opacity duration-300 z-[1003]';
                notification.textContent = message;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            }

            function copyToClipboard(text, successMessage) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification(successMessage);
                }).catch(err => {
                    console.error('Clipboard copy failed:', err);
                    showNotification('ë³µì‚¬ ì‹¤íŒ¨!');
                });
            }

            function showConfirmation(message, onConfirm) {
                dom.confirmModalMessage.textContent = message;
                confirmCallback = onConfirm;
                dom.confirmModal.classList.remove('hidden');
            }

            function attachEventListeners() {
                 if (dom.resetBtn) dom.resetBtn.addEventListener('click', handleReset);
                 if (dom.endRaidBtn) dom.endRaidBtn.addEventListener('click', handleEndRaid);
                 if (dom.muteBtn) dom.muteBtn.addEventListener('click', () => {
                     isMuted = !isMuted;
                     dom.muteBtn.textContent = isMuted ? 'ì†Œë¦¬ ì¼œê¸°' : 'ì†Œë¦¬ ë„ê¸°';
                     speak(`ìŒì„± ì•ˆë‚´ ${isMuted ? 'ë„ê¸°' : 'ì¼œê¸°'}`);
                 });
                
                 if (dom.resTimesDisplay) dom.resTimesDisplay.addEventListener('click', () => {
                     if (raidState.resScheduleTimes && raidState.resScheduleTimes.length > 0) {
                         const minutes = raidState.resScheduleTimes.map(ts => new Date(ts).getMinutes());
                         const textToCopy = `${minutes.join(', ')} ë¦¬ì €`;
                         copyToClipboard(textToCopy, `'${textToCopy}'ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                     }
                 });
                
                 if (dom.controlPanel) dom.controlPanel.addEventListener('click', (e) => {
                     const targetId = e.target.id || e.target.closest('button')?.id;
                     if (targetId === 'startRaidBtn') handleStartRaid();
                     if (targetId === 'deathBtn') handleDeath();
                     if (targetId === 'useResBtn') handleUseResurrection();
                 });

                 if (dom.addBishopBtn) dom.addBishopBtn.addEventListener('click', addBishop);

                 if (dom.bishopList) {
                     dom.bishopList.addEventListener('click', e => {
                         if (e.target.classList.contains('remove-bishop-btn')) {
                             const index = parseInt(e.target.dataset.index);
                             removeBishop(index);
                         }
                     });
                     dom.bishopList.addEventListener('blur', e => {
                         if (e.target.classList.contains('bishop-name')) {
                             const index = parseInt(e.target.dataset.index);
                             const newName = e.target.textContent.trim();
                             updateBishopName(index, newName);
                         }
                     }, true);
                     dom.bishopList.addEventListener('keydown', e => {
                         if (e.target.classList.contains('bishop-name') && e.key === 'Enter') {
                             e.preventDefault(); e.target.blur();
                         }
                     });
                 }
                
                 // Sidebar and Modal Listeners
                 if (dom.sidebarToggle) {
                     dom.sidebarToggle.addEventListener('click', () => {
                         dom.sidebar.classList.toggle('translate-x-full');
                         dom.sidebarToggle.classList.toggle('active');
                         dom.sidebarOverlay.classList.toggle('hidden');
                     });
                 }
                 if (dom.sidebarOverlay) {
                     dom.sidebarOverlay.addEventListener('click', closeSidebar);
                 }
                 if(dom.guideLink) dom.guideLink.addEventListener('click', (e) => { e.preventDefault(); document.getElementById('how-to-guide').scrollIntoView({ behavior: 'smooth' }); closeSidebar(); });
                 if(dom.contactLink) {
                     dom.contactLink.addEventListener('click', (e) => { 
                         e.preventDefault(); 
                         closeSidebar();
                         setTimeout(() => {
                             dom.contactModal.classList.remove('hidden');
                         }, 300);
                     });
                 }
                 if(dom.closeContactModalBtn) dom.closeContactModalBtn.addEventListener('click', () => dom.contactModal.classList.add('hidden'));
                 if(dom.contactModal) dom.contactModal.addEventListener('click', (e) => { if(e.target === dom.contactModal) dom.contactModal.classList.add('hidden'); });

                 // Confirmation Modal Listeners
                 if(dom.confirmCancelBtn) dom.confirmCancelBtn.addEventListener('click', () => {
                    dom.confirmModal.classList.add('hidden');
                    confirmCallback = null;
                 });
                 if(dom.confirmOkBtn) dom.confirmOkBtn.addEventListener('click', () => {
                    if (typeof confirmCallback === 'function') {
                        confirmCallback();
                    }
                    dom.confirmModal.classList.add('hidden');
                    confirmCallback = null;
                 });
            }
            
            function closeSidebar() {
                if(dom.sidebar) dom.sidebar.classList.add('translate-x-full');
                if(dom.sidebarToggle) dom.sidebarToggle.classList.remove('active');
                if(dom.sidebarOverlay) dom.sidebarOverlay.classList.add('hidden');
            }

            // --- STARTUP ---
            init();
        });
    </script>
</body>
</html>
